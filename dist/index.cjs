"use strict";var m=Object.defineProperty;var c=(i,t)=>m(i,"name",{value:t,configurable:!0});var a=require("node:fs/promises"),o=require("node:path"),g=require("node:fs"),w=require("node:os");typeof Symbol.asyncDispose!="symbol"&&Object.defineProperty(Symbol,"asyncDispose",{configurable:!1,enumerable:!1,writable:!1,value:Symbol.for("asyncDispose")});class b{static{c(this,"FsFixture")}path;cleanUp=!0;constructor(t){this.path=t}getPath(...t){return o.join(this.path,...t)}exists(t=""){return a.access(this.getPath(t)).then(()=>!0,()=>!1)}rm(t=""){return a.rm(this.getPath(t),{recursive:!0,force:!0})}cp(t,r,s){return a.cp(t,this.getPath(r),s)}writeFile(t,r){return a.writeFile(this.getPath(t),r)}writeJson(t,r){return this.writeFile(t,JSON.stringify(r,null,2))}readFile(t,r){return a.readFile(this.getPath(t),r)}debug(){console.log(`Fixture path: ${this.path}`),this.cleanUp=!1}async[Symbol.asyncDispose](){this.cleanUp&&await this.rm()}}const d=g.realpathSync(w.tmpdir()),F=`fs-fixture-${Date.now()}-${process.pid}`;let h=0;const P=c(()=>(h+=1,h),"getId");class u{static{c(this,"Symlink")}target;type;path;constructor(t,r){this.target=t,this.type=r}}const f=c((i,t,r)=>{const s=[];for(const l in i){if(!Object.hasOwn(i,l))continue;const e=o.join(t,l);let n=i[l];if(typeof n=="function"){const y=Object.assign(Object.create(r),{filePath:e}),p=n(y);if(p instanceof u){p.path=e,s.push(p);continue}else n=p}typeof n=="string"?s.push({path:e,content:n}):s.push(...f(n,e,r))}return s},"flattenFileTree"),v=c(async(i,t)=>{const r=t?.tempDir?o.resolve(t.tempDir):d,s=o.join(r,`${F}-${P()}/`);if(await a.mkdir(s,{recursive:!0}),i){if(typeof i=="string")await a.cp(i,s,{recursive:!0,filter:t?.templateFilter});else if(typeof i=="object"){const l={fixturePath:s,getPath:c((...e)=>o.join(s,...e),"getPath"),symlink:c((e,n)=>new u(e,n),"symlink")};await Promise.all(f(i,s,l).map(async e=>{await a.mkdir(o.dirname(e.path),{recursive:!0}),e instanceof u?await a.symlink(e.target,e.path,e.type):await a.writeFile(e.path,e.content)}))}}return new b(s)},"createFixture");exports.createFixture=v;
